Always use file scoped namespaces. Always combine attributes on a single line when possible. 
The project does not use nullable reference types. 
There is a GlobalUsings.cs file that includes common usings, don't include using statements in new files if they are already in the globalusings.cs file.
I prefer expression bodied members when possible. Single line if statements should still use braces. Use ternary operators when appropriate. 
Use internal over private. All classes and methods are public unless told otherwise. Don't add a constructor unless instructed to do so. 
Use primary constructors when possible and don't declare a class level variable if the parameter from the constructor can be used.
Don't initialize properties unless instructed to do so.

All work is to be done in the Autolot.API project unless otherwise specified.

Add the following global usings to the GlobalUsings.cs file if it does not already exist (sorted alphabetically. Don't remove any existing global using statements).
global using Microsoft.AspNetCore.OpenApi;
global using Microsoft.OpenApi;
global using Scalar.AspNetCore;

Add a new folder named ScalarUtilities, and in that folder create a new class named AddHeaderParameterDocumentFilter.cs with the following code:
namespace AutoLot.Api.ScalarUtilities;
public class AddHeaderParameterDocumentFilter : IOpenApiOperationTransformer
{
    public Task TransformAsync(OpenApiOperation operation, OpenApiOperationTransformerContext context, CancellationToken cancellationToken)
    {
        operation.Parameters ??= [];
        operation.Parameters.Add(new OpenApiParameter
        {
            Name = "Accept",
            In = ParameterLocation.Header,
            Required = false,
            Description = "Specifies the desired response format.",
            AllowEmptyValue = true,
            Schema = new OpenApiSchema
            {
                Type = JsonSchemaType.String
            }
        });

        return Task.CompletedTask;
    }
}

Update the project file for AutoLot.Models by adding the two nodes to the TargetFramework PropertyGroup to enable XML comments generation:
  <GenerateDocumentationFile>true</GenerateDocumentationFile>
  <NoWarn>1591</NoWarn>

Update the project file for AutoLot.Api by adding the three nodes to the TargetFramework PropertyGroup to enable XML comments generation, 
set the NoWarnd, and get OpenAPI specification version:
  <GenerateDocumentationFile>true</GenerateDocumentationFile>
  <NoWarn>1591</NoWarn>
  <OpenApiGenerateDocumentsOptions>--openapi-version OpenApi3_1</OpenApiGenerateDocumentsOptions>


Add the following to the top of the Program.cs file before and code and after any existing using statements:
using JsonOptions = Microsoft.AspNetCore.Http.Json.JsonOptions;

Add the following to Program.cs before builder.Services.AddScoped<ICarDriverRepo, CarDriverRepo>(); (don't add any additional calls except what's listed here):
builder.Services.Configure<JsonOptions>(options =>
{
  options.SerializerOptions.PropertyNamingPolicy = JsonNamingPolicy.CamelCase;
  options.SerializerOptions.DefaultIgnoreCondition = JsonIgnoreCondition.WhenWritingNull;
  options.SerializerOptions.WriteIndented = true;
  options.SerializerOptions.ReferenceHandler = ReferenceHandler.IgnoreCycles;
});

Add three local functions to Program.cs after all other code:
OpenApiInfo BuildDocumentInfo(string version, bool isDeprecated)
{
  var description = "API for AutoLot Car Dealership.";
  if (isDeprecated)
  {
    description += "<p><font color='red'>This API version has been deprecated.</font></p>";
  }
  return new()
  {
    Title = "AutoLot API",
    Version = version,
    Description = description,
    Contact = new OpenApiContact() { Name = "Phil Japikse", Email = "skimedic@outlook.com" },
    TermsOfService = new System.Uri("https://www.linktotermsofservice.com"),
    License = new OpenApiLicense()
    {
      Name = "MIT",
      Url = new Uri("https://opensource.org/licenses/MIT")
    }
  };
}

void AddDeprecated(OpenApiDocument openApiDocument, List<string> controllerNames)
{
  foreach (var path in openApiDocument.Paths.Where(x => x.Value?.Operations != null))
  {
    foreach (var op in path.Value.Operations!)
    {
      if (controllerNames is { Count: > 0 })
      {
        controllerNames
          .Where(controllerName => 
             path.Key.Contains($"/{controllerName}", StringComparison.OrdinalIgnoreCase))
          .ToList()
          .ForEach(controllerName => op.Value.Deprecated = true);
      }
      else
      {
        op.Value.Deprecated = true;
      }
    }
  }
}

void ConfigureOptions(
  OpenApiOptions openApiOptions,
  string documentName,
  bool includeBlankGroups = false,
  bool isDeprecated = false,
  List<string> controllerNamesToDeprecate = null)
{
  openApiOptions.AddDocumentTransformer((document, context, cancellationToken) 
    => {
         document.Info = BuildDocumentInfo("v1.5", true);
         if (isDeprecated)
         {
           AddDeprecated(document, controllerNamesToDeprecate);
         }
         return Task.CompletedTask;
  });


Remove the empty call to builder.Service.AddOpenApi();

Add the following to Program.cs before var app = builder.Build() (don't add any additional calls except what's listed here):
builder.Services.AddOpenApi("v1", options => 
  ConfigureOptions(options, "v1", includeBlankGroups: true));
builder.Services.AddOpenApi("v1.5", options => 
  ConfigureOptions(options, "v1.5", isDeprecated: true, controllerNamesToDeprecate: ["Cars"]));
builder.Services.AddOpenApi("v2", options => ConfigureOptions(options, "v2"));
builder.Services.AddOpenApi("v2.5-Beta", options => ConfigureOptions(options, "v2.5-Beta"));
builder.Services.AddOpenApi("v3-Beta", options => ConfigureOptions(options, "v3-Beta"));

Add the scalar code after the call to app.MapOpenApi();
var provider = app.Services.GetRequiredService<IApiVersionDescriptionProvider>();
app.MapScalarApiReference(options =>
{
  var docs = new List<ScalarDocument>();
  foreach (var versionDescription in provider.ApiVersionDescriptions)
  {
    var isDeprecated = versionDescription.IsDeprecated ? " (Deprecated)":"";
    var name = $"AutoLot API Version {versionDescription.ApiVersion.ToString()}{isDeprecated}";
    docs.Add(new ScalarDocument(versionDescription.GroupName, name));
  }
  options.AddDocuments(docs);
});

Update the launchSetting.json file replace "launchUrl": "openapi/v1.json" with "launchUrl": "scalar"

Add the swagger UI code after the call to app.MapOpenApi();
app.UseSwaggerUI(options =>
{
  var provider = app.Services.GetRequiredService<IApiVersionDescriptionProvider>();
  foreach (var description in provider.ApiVersionDescriptions)
  {
    var groupName = description.GroupName;
    var url = $"/openapi/{groupName}.json";
    var name = $"AutoLot API: {groupName}";
    options.SwaggerEndpoint(url, name);
  }
});


Update the launchSetting.json file replace "launchUrl": "openapi/v1.json" with "launchUrl": "swagger"



